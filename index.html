<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>短視頻文字稿多維度分析工具（Gemini 2.5 版）</title>
  <meta name="description" content="使用最新 Google Gemini 2.5 Flash AI 進行分析（高免費額度、超快）"/>
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <style>
    body { font-family: system-ui, -apple-system, sans-serif; margin: 0; background: linear-gradient(to bottom right, #edf2ff, #eef2ff, #f5f3ff); min-height: 100vh; }
    .container { max-width: 80rem; margin: 0 auto; padding: 1.5rem; }
    .card { background: white; border-radius: 0.75rem; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); overflow: hidden; }
    .header { background: linear-gradient(to right, #4f46e5, #9333ea); padding: 2rem; color: white; }
    .header h1 { font-size: 2.25rem; font-weight: 700; display: flex; align-items: center; gap: 1rem; }
    .content { padding: 2rem; display: flex; flex-direction: column; gap: 2rem; }
    .btn-grid { display: grid; grid-template-columns: 1fr; gap: 1rem; }
    @media (min-width: 768px) { .btn-grid { grid-template-columns: repeat(3, 1fr); } }
    .btn { padding: 1rem 1.5rem; border-radius: 0.5rem; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 0.75rem; transition: background 0.2s; }
    .btn.active, .btn-primary { background: #4f46e5; color: white; }
    .btn-secondary { background: white; border: 1px solid #d1d5db; color: #374151; }
    .btn-secondary:hover { background: #f3f4f6; }
    .textarea { width: 100%; padding: 1rem; border: 1px solid #d1d5db; border-radius: 0.5rem; min-height: 300px; resize: vertical; font-size: 1rem; }
    .textarea:focus { outline: none; box-shadow: 0 0 0 4px rgba(79,70,229,0.3); }
    pre { background: #f3f4f6; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; white-space: pre-wrap; }
    .hidden { display: none; }
    .flex { display: flex; }
    .gap-4 { gap: 1rem; }
    .flex-1 { flex: 1; }
    .text-center { text-align: center; }
    .animate-spin { animation: spin 1s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    .alert { padding: 1.5rem; border-radius: 0.75rem; border: 1px solid; }
    .alert-warning { background: #fffbeb; border-color: #fcd34d; color: #78350f; }
    .alert-error { background: #fee2e2; border-color: #fca5a5; color: #991b1b; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <!-- Header -->
      <div class="header">
        <h1>
          <i data-lucide="file-text" class="w-10 h-10"></i>
          短視頻文字稿多維度分析工具
        </h1>
        <p class="text-lg opacity-90 mt-3">最新 Google Gemini 2.5 Flash 驅動（更快、更強、免費額度高）</p>
      </div>

      <div class="content">
        <!-- 其餘 UI 完全相同，省略以節省篇幅 -->

        <!-- Gemini 分析（關鍵修正處） -->
        <script>
          // ... 前面的程式碼完全相同 ...

          els.analyzeBtn.onclick = async () => {
            const apiKey = localStorage.getItem('gemini_api_key');
            if (!apiKey) return alert('請先儲存 Gemini API Key！');

            els.analyzing.classList.remove('hidden');
            els.analyzeSection.classList.add('hidden');
            els.result.classList.add('hidden');
            els.errorMsg.classList.add('hidden');

            try {
              const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  contents: [{
                    role: "user",
                    parts: [{ text: `你是一位專業的內容分析師。請對以下短視頻文字稿進行全面分析，並嚴格以純 JSON 格式回應（不要任何 markdown 或說明文字）：

【文字稿內容】
${currentTranscript}

請使用以下 JSON 結構：
{
  "truthRating": 1到5的整數,
  "aiGenerated": "低" | "中" | "高",
  "scamRisk": "無" | "低" | "中" | "高" | "極高",
  "innovationValue": "無" | "低" | "中" | "高" | "突破性",
  "consciousnessLevel": "詳細描述意識層級",
  "recommendation": "可信" | "謹慎對待" | "高度質疑" | "避免傳播",
  "truthVerification": { "factCheck": "...", "sourceTracking": "...", "logicConsistency": "..." },
  "aiHallucination": { "contentFeatures": "...", "factualErrors": "...", "credibilityScore": 1到10的整數 },
  "scamDetection": { "urgencyManipulation": "...", "authorityImpersonation": "...", "emotionalManipulation": "...", "overPromising": "..." },
  "aiInnovation": { "technicalInnovation": "...", "practicalValue": "...", "feasibility": "..." },
  "redFlags": ["...", "..."],
  "positives": ["...", "..."],
  "improvements": ["...", "..."]
}` }]
                  }],
                  generationConfig: { temperature: 0.3, maxOutputTokens: 4000 }
                })
              });

              // ... 後面的錯誤處理與渲染完全相同 ...
            } catch (err) {
              // ...
            }
          };

          // renderResult 與 exportBtn 完全相同
        </script>
      </div>
    </div>
  </div>
</body>
</html>
