<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>çŸ­è¦–é »æ–‡å­—ç¨¿å¤šç¶­åº¦åˆ†æå·¥å…·ï¼ˆGemini ç‰ˆï¼‰</title>
  <meta name="description" content="ä½¿ç”¨ Google Gemini AI é€²è¡ŒçœŸå½è¾¨è­˜ã€è©é¨™æª¢æ¸¬èˆ‡å‰µæ–°è©•ä¼°ï¼ˆé«˜å…è²»é¡åº¦ã€è¶…å¿«ï¼‰"/>
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <style>
    body { font-family: system-ui, -apple-system, sans-serif; margin: 0; background: linear-gradient(to bottom right, #edf2ff, #eef2ff, #f5f3ff); min-height: 100vh; }
    .container { max-width: 80rem; margin: 0 auto; padding: 1.5rem; }
    .card { background: white; border-radius: 0.75rem; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); overflow: hidden; }
    .header { background: linear-gradient(to right, #4f46e5, #9333ea); padding: 2rem; color: white; }
    .header h1 { font-size: 2.25rem; font-weight: 700; display: flex; align-items: center; gap: 1rem; }
    .content { padding: 2rem; display: flex; flex-direction: column; gap: 2rem; }
    .btn-grid { display: grid; grid-template-columns: 1fr; gap: 1rem; }
    @media (min-width: 768px) { .btn-grid { grid-template-columns: repeat(3, 1fr); } }
    .btn { padding: 1rem 1.5rem; border-radius: 0.5rem; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 0.75rem; transition: background 0.2s; }
    .btn.active, .btn-primary { background: #4f46e5; color: white; }
    .btn-secondary { background: white; border: 1px solid #d1d5db; color: #374151; }
    .btn-secondary:hover { background: #f3f4f6; }
    .textarea { width: 100%; padding: 1rem; border: 1px solid #d1d5db; border-radius: 0.5rem; min-height: 300px; resize: vertical; font-size: 1rem; }
    .textarea:focus { outline: none; box-shadow: 0 0 0 4px rgba(79,70,229,0.3); }
    pre { background: #f3f4f6; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; white-space: pre-wrap; }
    .hidden { display: none; }
    .flex { display: flex; }
    .gap-4 { gap: 1rem; }
    .flex-1 { flex: 1; }
    .text-center { text-align: center; }
    .animate-spin { animation: spin 1s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    .alert { padding: 1.5rem; border-radius: 0.75rem; border: 1px solid; }
    .alert-warning { background: #fffbeb; border-color: #fcd34d; color: #78350f; }
    .alert-error { background: #fee2e2; border-color: #fca5a5; color: #991b1b; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <!-- Header -->
      <div class="header">
        <h1>
          <i data-lucide="file-text" class="w-10 h-10"></i>
          çŸ­è¦–é »æ–‡å­—ç¨¿å¤šç¶­åº¦åˆ†æå·¥å…·
        </h1>
        <p class="text-lg opacity-90 mt-3">Google Gemini AI é©…å‹•ï¼ˆé«˜å…è²»é¡åº¦ã€é€Ÿåº¦å¿«ã€å“è³ªå„ªï¼‰</p>
      </div>

      <div class="content">
        <!-- è¼¸å…¥æ–¹å¼ -->
        <div class="p-6 bg-gray-50 rounded-xl border border-gray-200">
          <h3 class="text-lg font-semibold mb-4">ğŸ“¥ é¸æ“‡è¼¸å…¥æ–¹å¼</h3>
          <div class="btn-grid">
            <button id="mode-paste" class="btn active btn-primary">
              <i data-lucide="edit-3"></i> è²¼ä¸Šæ–‡å­—
            </button>
            <button id="mode-file" class="btn btn-secondary">
              <i data-lucide="upload"></i> ä¸Šå‚³ TXT
            </button>
            <button id="mode-sample" class="btn btn-secondary">
              <i data-lucide="play-circle"></i> ç¯„ä¾‹æ–‡å­—ç¨¿
            </button>
          </div>
        </div>

        <!-- è²¼ä¸Šå€åŸŸ -->
        <div id="paste-area">
          <label class="block text-lg font-semibold mb-2">è«‹è²¼ä¸Šæ–‡å­—ç¨¿å…§å®¹</label>
          <textarea id="transcript-input" class="textarea" placeholder="åœ¨æ­¤è²¼ä¸Šå®Œæ•´çš„çŸ­è¦–é »æ–‡å­—ç¨¿..."></textarea>
          <button id="confirm-paste" class="mt-4 px-8 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700">
            ç¢ºèªä¸¦æº–å‚™åˆ†æ
          </button>
        </div>

        <!-- æª”æ¡ˆä¸Šå‚³ -->
        <div id="file-area" class="hidden">
          <label class="block text-lg font-semibold mb-2">é¸æ“‡ TXT æª”æ¡ˆ</label>
          <input type="file" id="file-input" accept=".txt,text/plain" class="w-full p-3 border rounded-lg" />
        </div>

        <!-- åŸå§‹å…§å®¹ -->
        <div id="original-content" class="hidden p-6 bg-gray-50 rounded-xl border">
          <h3 class="font-semibold text-lg mb-3 flex items-center gap-2">
            <i data-lucide="info"></i> æ–‡å­—ç¨¿å…§å®¹
          </h3>
          <pre id="content-display"></pre>
        </div>

        <!-- åˆ†ææŒ‰éˆ• -->
        <div id="analyze-section" class="hidden flex gap-4">
          <button id="analyze-btn" class="flex-1 py-4 bg-indigo-600 text-white rounded-lg font-bold text-lg flex items-center justify-center gap-3 hover:bg-indigo-700">
            <i data-lucide="brain"></i> é–‹å§‹ Gemini åˆ†æ
          </button>
          <button id="export-btn" class="hidden py-4 px-8 bg-green-600 text-white rounded-lg font-bold flex items-center gap-3 hover:bg-green-700">
            <i data-lucide="download"></i> åŒ¯å‡º MD
          </button>
        </div>

        <!-- åˆ†æä¸­ -->
        <div id="analyzing" class="hidden text-center py-12">
          <i data-lucide="loader-2" class="w-16 h-16 animate-spin text-indigo-600 mx-auto mb-4"></i>
          <p class="text-xl text-gray-700">Gemini æ­£åœ¨åˆ†æï¼ˆé€šå¸¸ 5-15 ç§’ï¼‰...</p>
        </div>

        <!-- çµæœ -->
        <div id="result" class="hidden space-y-8"></div>

        <!-- éŒ¯èª¤ -->
        <div id="error-msg" class="hidden alert alert-error">
          <h3 class="font-bold flex items-center gap-2">
            <i data-lucide="alert-triangle"></i> ç™¼ç”ŸéŒ¯èª¤
          </h3>
          <p id="error-text" class="mt-2"></p>
        </div>

        <!-- Gemini API Key -->
        <div class="alert alert-warning">
          <p class="font-medium">
            éœ€è¦ <strong>Google Gemini API Key</strong>ï¼ˆå®Œå…¨å…è²»ç”³è«‹ï¼‰ã€‚<br/>
            è«‹åˆ° <a href="https://aistudio.google.com/app/apikey" target="_blank" class="underline">Google AI Studio</a> å»ºç«‹ Keyï¼ˆAIzaSy... é–‹é ­ï¼‰ï¼Œç„¶å¾Œè²¼ä¸‹æ–¹ï¼š
          </p>
          <input type="password" id="api-key-input" placeholder="è¼¸å…¥ Gemini API Key" class="mt-4 w-full p-4 border border-amber-300 rounded-lg"/>
          <button id="save-key" class="mt-3 px-6 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700">å„²å­˜ Key</button>
          <p class="mt-3 text-sm">Key åªå„²å­˜åœ¨æ‚¨çš„ç€è¦½å™¨æœ¬åœ°ï¼Œå®‰å…¨ç„¡è™ã€‚Gemini 1.5 Flash æ¯å¤©æœ‰é«˜é¡å…è²»é¡åº¦ï¼</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    lucide.createIcons();

    const els = {
      transcriptInput: document.getElementById('transcript-input'),
      confirmPaste: document.getElementById('confirm-paste'),
      fileInput: document.getElementById('file-input'),
      contentDisplay: document.getElementById('content-display'),
      originalContent: document.getElementById('original-content'),
      analyzeSection: document.getElementById('analyze-section'),
      analyzeBtn: document.getElementById('analyze-btn'),
      exportBtn: document.getElementById('export-btn'),
      analyzing: document.getElementById('analyzing'),
      result: document.getElementById('result'),
      errorMsg: document.getElementById('error-msg'),
      errorText: document.getElementById('error-text'),
      apiKeyInput: document.getElementById('api-key-input'),
      saveKey: document.getElementById('save-key')
    };

    let currentTranscript = '';
    let currentAnalysis = null;

    // API Key
    if (localStorage.getItem('gemini_api_key')) {
      els.apiKeyInput.placeholder = 'Key å·²å„²å­˜ï¼ˆå¯ä¿®æ”¹ï¼‰';
    }

    els.saveKey.onclick = () => {
      const key = els.apiKeyInput.value.trim();
      if (key.startsWith('AIzaSy')) {
        localStorage.setItem('gemini_api_key', key);
        alert('Gemini API Key å„²å­˜æˆåŠŸï¼');
      } else if (key === '') {
        localStorage.removeItem('gemini_api_key');
        alert('å·²æ¸…é™¤ Key');
      } else {
        alert('è«‹è¼¸å…¥æ­£ç¢ºçš„ Gemini API Keyï¼ˆä»¥ AIzaSy é–‹é ­ï¼‰');
      }
    };

    // æ¨¡å¼åˆ‡æ›
    document.querySelectorAll('.btn').forEach(btn => {
      if (!btn.id.startsWith('mode-')) return;
      btn.addEventListener('click', () => {
        document.querySelectorAll('.btn').forEach(b => {
          b.classList.remove('active', 'btn-primary');
          b.classList.add('btn-secondary');
        });
        btn.classList.add('active', 'btn-primary');
        btn.classList.remove('btn-secondary');

        document.getElementById('paste-area').classList.toggle('hidden', btn.id !== 'mode-paste');
        document.getElementById('file-area').classList.toggle('hidden', btn.id !== 'mode-file');

        if (btn.id === 'mode-sample') {
          els.transcriptInput.value = `æœ€è¿‘ç™¼ç¾ä¸€å€‹è¶…ç´šè³ºéŒ¢çš„ç§˜å¯†ï¼åªéœ€æŠ•è³‡3è¬å…ƒï¼Œä¿è­‰ä¸€å€‹æœˆå…§å›æœ¬ä¸¦è³ºåˆ°10å€ï¼é€™æ˜¯å…§éƒ¨æ¶ˆæ¯ï¼Œåªæœ‰å°‘æ•¸äººçŸ¥é“ï¼Œç¾åœ¨é¦¬ä¸ŠåŠ å…¥ä¸ç„¶å°±æ™šäº†ï¼ç§è¨Šæˆ‘ç²å–åé¡ï¼Œåªæœ‰æœ€å¾Œ5å€‹ä½ç½®ï¼`;
          els.confirmPaste.click();
        }
      });
    });

    // ç¢ºèªè¼¸å…¥
    els.confirmPaste.onclick = () => {
      currentTranscript = els.transcriptInput.value.trim();
      if (!currentTranscript) return alert('è«‹è¼¸å…¥å…§å®¹');
      els.contentDisplay.textContent = currentTranscript;
      els.originalContent.classList.remove('hidden');
      els.analyzeSection.classList.remove('hidden');
      els.result.classList.add('hidden');
      els.errorMsg.classList.add('hidden');
      els.exportBtn.classList.add('hidden');
    };

    els.fileInput.onchange = e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = ev => {
        currentTranscript = ev.target.result;
        els.contentDisplay.textContent = currentTranscript;
        els.originalContent.classList.remove('hidden');
        els.analyzeSection.classList.remove('hidden');
        els.result.classList.add('hidden');
        els.errorMsg.classList.add('hidden');
        els.exportBtn.classList.add('hidden');
      };
      reader.readAsText(file);
    };

    // Gemini åˆ†æ
    els.analyzeBtn.onclick = async () => {
      const apiKey = localStorage.getItem('gemini_api_key');
      if (!apiKey) return alert('è«‹å…ˆå„²å­˜ Gemini API Keyï¼');

      els.analyzing.classList.remove('hidden');
      els.analyzeSection.classList.add('hidden');
      els.result.classList.add('hidden');
      els.errorMsg.classList.add('hidden');

      try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{
              role: "user",
              parts: [{ text: `ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„å…§å®¹åˆ†æå¸«ã€‚è«‹å°ä»¥ä¸‹çŸ­è¦–é »æ–‡å­—ç¨¿é€²è¡Œå…¨é¢åˆ†æï¼Œä¸¦åš´æ ¼ä»¥ç´” JSON æ ¼å¼å›æ‡‰ï¼ˆä¸è¦ä»»ä½• markdown æˆ–èªªæ˜æ–‡å­—ï¼‰ï¼š

ã€æ–‡å­—ç¨¿å…§å®¹ã€‘
${currentTranscript}

è«‹ä½¿ç”¨ä»¥ä¸‹ JSON çµæ§‹ï¼š
{
  "truthRating": 1åˆ°5çš„æ•´æ•¸,
  "aiGenerated": "ä½" | "ä¸­" | "é«˜",
  "scamRisk": "ç„¡" | "ä½" | "ä¸­" | "é«˜" | "æ¥µé«˜",
  "innovationValue": "ç„¡" | "ä½" | "ä¸­" | "é«˜" | "çªç ´æ€§",
  "consciousnessLevel": "è©³ç´°æè¿°æ„è­˜å±¤ç´š",
  "recommendation": "å¯ä¿¡" | "è¬¹æ…å°å¾…" | "é«˜åº¦è³ªç–‘" | "é¿å…å‚³æ’­",
  "truthVerification": { "factCheck": "...", "sourceTracking": "...", "logicConsistency": "..." },
  "aiHallucination": { "contentFeatures": "...", "factualErrors": "...", "credibilityScore": 1åˆ°10çš„æ•´æ•¸ },
  "scamDetection": { "urgencyManipulation": "...", "authorityImpersonation": "...", "emotionalManipulation": "...", "overPromising": "..." },
  "aiInnovation": { "technicalInnovation": "...", "practicalValue": "...", "feasibility": "..." },
  "redFlags": ["...", "..."],
  "positives": ["...", "..."],
  "improvements": ["...", "..."]
}` }]
            }],
            generationConfig: { temperature: 0.3, maxOutputTokens: 4000 }
          })
        });

        if (!response.ok) {
          const err = await response.json();
          throw new Error(err.error?.message || 'API è«‹æ±‚å¤±æ•—');
        }

        const data = await response.json();
        const text = data.candidates[0].content.parts[0].text.trim();
        const jsonText = text.replace(/```json\n?|```/g, '').trim();
        currentAnalysis = JSON.parse(jsonText);

        renderResult(currentAnalysis);
        els.exportBtn.classList.remove('hidden');
      } catch (err) {
        els.errorText.textContent = err.message.includes('quota') ? 'å·²è¶…éå…è²»é¡åº¦ï¼Œè«‹æ˜æ—¥å†è©¦æˆ–å‡ç´š' : err.message;
        els.errorMsg.classList.remove('hidden');
      } finally {
        els.analyzing.classList.add('hidden');
        lucide.createIcons();
      }
    };

    function renderResult(a) {
      els.result.innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="p-6 bg-blue-50 rounded-xl border border-blue-200">
            <h4 class="font-bold text-blue-900 flex items-center gap-2 mb-3"><i data-lucide="check-circle"></i> çœŸå¯¦æ€§è©•ç´š</h4>
            <div class="text-3xl mb-2">${'â­'.repeat(a.truthRating)}${'â˜†'.repeat(5-a.truthRating)}</div>
            <p class="text-blue-800">${a.recommendation}</p>
          </div>
          <div class="p-6 bg-purple-50 rounded-xl border border-purple-200">
            <h4 class="font-bold text-purple-900 flex items-center gap-2 mb-3"><i data-lucide="brain"></i> AI ç”Ÿæˆå¯èƒ½æ€§</h4>
            <div class="text-3xl font-bold text-purple-700">${a.aiGenerated}</div>
            <p class="text-sm mt-2">å¯ä¿¡åº¦ ${a.aiHallucination.credibilityScore}/10</p>
          </div>
          <div class="p-6 bg-red-50 rounded-xl border border-red-200">
            <h4 class="font-bold text-red-900 flex items-center gap-2 mb-3"><i data-lucide="alert-triangle"></i> è©é¨™é¢¨éšª</h4>
            <div class="text-3xl font-bold text-red-700">${a.scamRisk}</div>
            <p class="text-sm mt-2">å‰µæ–°åƒ¹å€¼ï¼š${a.innovationValue}</p>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
          <div class="p-6 bg-white rounded-xl border shadow">
            <h4 class="font-bold mb-4 flex items-center gap-2"><i data-lucide="shield"></i> çœŸå¯¦æ€§é©—è­‰</h4>
            <ul class="space-y-2 text-sm">
              <li><strong>äº‹å¯¦æŸ¥æ ¸ï¼š</strong>${a.truthVerification.factCheck}</li>
              <li><strong>ä¾†æºè¿½æº¯ï¼š</strong>${a.truthVerification.sourceTracking}</li>
              <li><strong>é‚è¼¯ä¸€è‡´æ€§ï¼š</strong>${a.truthVerification.logicConsistency}</li>
            </ul>
          </div>
          <div class="p-6 bg-white rounded-xl border shadow">
            <h4 class="font-bold mb-4 flex items-center gap-2"><i data-lucide="zap"></i> AI å¹»è¦ºè­˜åˆ¥</h4>
            <ul class="space-y-2 text-sm">
              <li><strong>å…§å®¹ç‰¹å¾µï¼š</strong>${a.aiHallucination.contentFeatures}</li>
              <li><strong>äº‹å¯¦éŒ¯èª¤ï¼š</strong>${a.aiHallucination.factualErrors}</li>
            </ul>
          </div>
          <div class="p-6 bg-white rounded-xl border shadow">
            <h4 class="font-bold mb-4 flex items-center gap-2"><i data-lucide="alert-octagon"></i> è©é¨™æ‰‹æ³•æª¢æ¸¬</h4>
            <ul class="space-y-2 text-sm">
              <li><strong>ç·Šè¿«æ€§æ“ç¸±ï¼š</strong>${a.scamDetection.urgencyManipulation}</li>
              <li><strong>æ¬Šå¨å†’å……ï¼š</strong>${a.scamDetection.authorityImpersonation}</li>
              <li><strong>æƒ…æ„Ÿæ“æ§ï¼š</strong>${a.scamDetection.emotionalManipulation}</li>
              <li><strong>éåº¦æ‰¿è«¾ï¼š</strong>${a.scamDetection.overPromising}</li>
            </ul>
          </div>
          <div class="p-6 bg-white rounded-xl border shadow">
            <h4 class="font-bold mb-4 flex items-center gap-2"><i data-lucide="trending-up"></i> AI å‰µæ–°è©•ä¼°</h4>
            <ul class="space-y-2 text-sm">
              <li><strong>æŠ€è¡“å‰µæ–°ï¼š</strong>${a.aiInnovation.technicalInnovation}</li>
              <li><strong>å¯¦ç”¨åƒ¹å€¼ï¼š</strong>${a.aiInnovation.practicalValue}</li>
              <li><strong>å¯è¡Œæ€§ï¼š</strong>${a.aiInnovation.feasibility}</li>
            </ul>
          </div>
        </div>

        ${a.redFlags?.length ? `<div class="mt-8 p-6 bg-red-50 rounded-xl border border-red-200">
          <h4 class="font-bold text-red-800 mb-4 flex items-center gap-2"><i data-lucide="flag"></i> ç´…æ——è­¦ç¤º</h4>
          <ul class="list-disc list-inside space-y-1 text-red-700">${a.redFlags.map(f => `<li>${f}</li>`).join('')}</ul>
        </div>` : ''}

        ${a.positives?.length ? `<div class="mt-8 p-6 bg-green-50 rounded-xl border border-green-200">
          <h4 class="font-bold text-green-800 mb-4 flex items-center gap-2"><i data-lucide="check-circle"></i> æ­£é¢äº®é»</h4>
          <ul class="list-disc list-inside space-y-1 text-green-700">${a.positives.map(p => `<li>${p}</li>`).join('')}</ul>
        </div>` : ''}

        <div class="mt-8 p-6 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl border border-indigo-200">
          <h4 class="font-bold text-indigo-900 mb-3">ğŸ§  æ„è­˜å±¤ç´šè©•ä¼°</h4>
          <p class="text-indigo-800 text-lg">${a.consciousnessLevel}</p>
        </div>
      `;
      els.result.classList.remove('hidden');
      lucide.createIcons();
    }

    els.exportBtn.onclick = () => {
      const timestamp = new Date().toLocaleString('zh-TW');
      const stars = 'â­'.repeat(currentAnalysis.truthRating) + 'â˜†'.repeat(5 - currentAnalysis.truthRating);
      const md = `# çŸ­è¦–é »æ–‡å­—ç¨¿åˆ†æå ±å‘Šï¼ˆGemini ç‰ˆï¼‰

## åŸå§‹æ–‡å­—ç¨¿
\`\`\`
${currentTranscript}
\`\`\`

## ç¶œåˆè©•ä¼°æ‘˜è¦
- **çœŸå¯¦æ€§è©•ç´š**: ${stars} (${currentAnalysis.truthRating}/5)
- **AIç”Ÿæˆå¯èƒ½æ€§**: ${currentAnalysis.aiGenerated}
- **è©é¨™é¢¨éšªç­‰ç´š**: ${currentAnalysis.scamRisk}
- **å‰µæ–°åƒ¹å€¼**: ${currentAnalysis.innovationValue}
- **æ„è­˜å±¤ç´š**: ${currentAnalysis.consciousnessLevel}
- **æ•´é«”å»ºè­°**: ${currentAnalysis.recommendation}

*å ±å‘Šç”Ÿæˆæ™‚é–“: ${timestamp}*
`;

      const blob = new Blob([md], { type: 'text/markdown;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `æ–‡å­—ç¨¿åˆ†æå ±å‘Š_Gemini_${Date.now()}.md`;
      a.click();
      URL.revokeObjectURL(url);
    };
  </script>
</body>
</html>
